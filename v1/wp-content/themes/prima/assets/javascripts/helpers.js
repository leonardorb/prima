// Generated by CoffeeScript 1.6.3
(function() {
  var _this = this;

  $(document).ready(function() {
    Handlebars.registerHelper('strToHtml', function(str) {
      return new Handlebars.SafeString(str);
    });
    Handlebars.registerHelper('pluralize', function(value, single, multiple) {
      if (value <= 1) {
        return "" + value + " " + single;
      }
      return "" + value + " " + multiple;
    });
    Handlebars.registerHelper('addComment', function(commentsCount) {
      if (commentsCount === 0) {
        return 'Start the conversation';
      } else {
        return 'Join the conversation';
      }
    });
    Prima.Utilities.srtftime = function(date, format) {
      var dateFormatted;
      if (!_.isDate(date)) {
        dateFormatted = new Date(Date.parse(date));
      }
      return dateFormatted.toString(format);
    };
    Handlebars.registerHelper('isCommentParent', function(comment, options) {
      if (comment.parent === 0) {
        return options.fn(comment);
      }
    });
    Handlebars.registerHelper('isAdminComment', function(comment, options) {
      if ((comment.author != null) && comment.author.id === 1) {
        return options.fn(true);
      }
    });
    Handlebars.registerHelper('getChilds', function(parentComment, comments, options) {
      var childs, commentsHTML;
      commentsHTML = '';
      childs = _.each(comments, function(comment) {
        var isAdminComment, _ref;
        if (comment.parent === parentComment.id) {
          isAdminComment = ((_ref = comment.author) != null ? _ref.id : void 0) === 1;
          commentsHTML += '<div id="comment-' + comment.id + '" class="comment-child';
          if (isAdminComment) {
            commentsHTML += ' comment-admin">';
          } else {
            commentsHTML += '">';
          }
          if (isAdminComment) {
            comment.name = comment.author.name;
          }
          commentsHTML += '<div class="comment-child-photo"><span>' + Prima.Utilities.getAvatar(comment.email) + '</span></div>';
          commentsHTML += '<div class="comment-child-data"><div class="comment-child-content-author-and-date">';
          commentsHTML += '<span class="comment-child-author">' + comment.name + '&nbsp;&nbsp;</span>';
          commentsHTML += '<span class="comment-child-date"><a href="#comment-' + comment.id + '">' + Prima.Utilities.srtftime(comment.date, "MMMM d, yyyy h:mm:ss tt") + '</a><span></div>';
          commentsHTML += '<div class="comment-child-content">' + comment.content + '</div>';
          return commentsHTML += '</div></div>';
        }
      });
      return new Handlebars.SafeString(commentsHTML);
    });
    Prima.Utilities.getAvatar = function(email) {
      var gravatarElement, md5email;
      md5email = md5(email);
      gravatarElement = '<img src="http://www.gravatar.com/avatar/' + md5email + '?d=' + encodeURIComponent('http://0.gravatar.com/avatar/ad516503a11cd5ca435acc9bb6523536?s=80') + '" />';
      return new Handlebars.SafeString(gravatarElement);
    };
    Handlebars.registerHelper('srtftime', Prima.Utilities.srtftime);
    return Handlebars.registerHelper('getAvatar', Prima.Utilities.getAvatar);
  });

}).call(this);

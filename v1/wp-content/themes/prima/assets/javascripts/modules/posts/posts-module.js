// Generated by CoffeeScript 1.6.3
(function() {
  var __hasProp = {}.hasOwnProperty,
    __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

  Prima.Modules.Posts = Prima.App.module('Posts', {
    define: function(PostsModule, App, Backbone, Marionette, $, _) {
      var _ref;
      PostsModule.Controller = (function(_super) {
        __extends(Controller, _super);

        function Controller() {
          _ref = Controller.__super__.constructor.apply(this, arguments);
          return _ref;
        }

        Controller.prototype.index = function() {
          var Posts;
          $('.loading').show();
          Posts = new Prima.Collections.Posts();
          return Posts.fetch({
            success: function() {
              var postsView;
              postsView = new PostsModule.PostsView({
                collection: Posts
              });
              Prima.App.main.show(postsView);
              return document.title = 'leonardo.io';
            }
          });
        };

        Controller.prototype.single = function(slug) {
          var Post;
          $('.loading').show();
          Post = new Prima.Models.Post({
            slug: slug
          });
          return Post.fetch({
            success: function() {
              var Page, postView;
              if (Post.get('status') === 'ok') {
                postView = new PostsModule.PostView({
                  model: Post
                });
                Prima.App.main.show(postView);
                return document.title = Post.get('post').title + ' | leonardo.io';
              } else {
                Page = new Prima.Models.Page({
                  slug: slug
                });
                return Page.fetch({
                  success: function(model, response) {
                    if (response.status !== 'error') {
                      postView = new PostsModule.PostView({
                        model: Page
                      });
                      Prima.App.main.show(postView);
                      return document.title = Page.get('page').title + ' | leonardo.io';
                    } else {
                      return document.title = '404 - Page not found | leonardo.io';
                    }
                  }
                });
              }
            }
          });
        };

        return Controller;

      })(Backbone.Marionette.Controller);
      return PostsModule.controller = new PostsModule.Controller();
    }
  });

}).call(this);
